(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6408],{7235:(e,t,s)=>{"use strict";s.d(t,{d:()=>l});var a=s(95155);s(12115);var r=s(66558),n=s(25016);function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"switch",className:(0,n.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(r.zi,{"data-slot":"switch-thumb",className:(0,n.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},27109:(e,t,s)=>{Promise.resolve().then(s.bind(s,79584))},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(95155);s(12115);var r=s(25016);function n(e){let{className:t,type:s,...n}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>x,L3:()=>p,c7:()=>m,lG:()=>o,rr:()=>g,zM:()=>d});var a=s(95155);s(12115);var r=s(41590),n=s(65229),l=s(25016);function o(e){let{...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,a.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function i(e){let{...t}=e;return(0,a.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...s}=e;return(0,a.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function u(e){let{className:t,children:s,showCloseButton:o=!0,...d}=e;return(0,a.jsxs)(i,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[s,o&&(0,a.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function x(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,l.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,l.cn)("text-lg leading-none font-semibold",t),...s})}function g(e){let{className:t,...s}=e;return(0,a.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,l.cn)("text-muted-foreground text-sm",t),...s})}},79584:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(95155),r=s(12115),n=s(20063),l=s(6707),o=s(22312),d=s(83209),i=s(97003),c=s(33789),u=s(90235),m=s(7235),x=s(90923),p=s(50906),g=s(6132),h=s(91169),f=s(17910),b=s(96583),j=s(65229),v=s(54679);function y(){let{isAuthenticated:e,isLoading:t,user:s,token:y}=(0,l.A)(),N=(0,n.useRouter)(),[w,k]=(0,r.useState)(""),[C,_]=(0,r.useState)([]),[E,S]=(0,r.useState)([]),[A,z]=(0,r.useState)(!0),[B,Z]=(0,r.useState)(!1),[F,G]=(0,r.useState)("stardeck"),[R,D]=(0,r.useState)(null),[L,T]=(0,r.useState)(null),[W,U]=(0,r.useState)(""),[J,O]=(0,r.useState)(!1),[I,M]=(0,r.useState)({name:"",display_name:"",description:"",sync_to_system:!1}),$=(0,r.useCallback)(async()=>{if(y)try{let e=await fetch("/api/groups",{headers:{Authorization:"Bearer ".concat(y)}});if(!e.ok)throw Error("Failed to fetch groups");let t=await e.json();_(t||[]),D(null)}catch(e){D(e instanceof Error?e.message:"Failed to load groups")}finally{z(!1)}},[y]),P=(0,r.useCallback)(async()=>{if(y)try{let e=await fetch("/api/system/groups",{headers:{Authorization:"Bearer ".concat(y)}});if(!e.ok)throw Error("Failed to fetch system groups");let t=await e.json();S(t||[])}catch(e){console.error("Failed to fetch system groups:",e)}},[y]);if((0,r.useEffect)(()=>{t||e?t||(null==s?void 0:s.role)==="admin"||N.push("/dashboard"):N.push("/login")},[e,t,s,N]),(0,r.useEffect)(()=>{let e=()=>{k(new Date().toLocaleTimeString("en-US",{hour12:!1}))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{e&&(null==s?void 0:s.role)==="admin"&&y&&($(),P())},[e,s,y,$,P]),t||!e||(null==s?void 0:s.role)!=="admin")return(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,a.jsx)(p.A,{className:"w-12 h-12 text-accent animate-pulse"})});let X=async e=>{if(e.preventDefault(),y)try{let e=await fetch("/api/groups",{method:"POST",headers:{Authorization:"Bearer ".concat(y),"Content-Type":"application/json"},body:JSON.stringify(I)});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to create group")}Z(!1),$(),I.sync_to_system&&P(),M({name:"",display_name:"",description:"",sync_to_system:!1})}catch(e){alert(e instanceof Error?e.message:"Failed to create group")}},q=async e=>{if(y&&confirm("Are you sure you want to delete this group?"))try{if(!(await fetch("/api/groups/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(y)}})).ok)throw Error("Failed to delete group");$(),P()}catch(e){alert(e instanceof Error?e.message:"Failed to delete group")}},V=async(e,t)=>{if(y&&t.trim()){O(!0);try{let s=await fetch("/api/system/groups/".concat(encodeURIComponent(e),"/members"),{method:"POST",headers:{Authorization:"Bearer ".concat(y),"Content-Type":"application/json"},body:JSON.stringify({username:t.trim()})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Failed to add user to group")}await P(),U("")}catch(e){alert(e instanceof Error?e.message:"Failed to add user to group")}finally{O(!1)}}},K=async(e,t)=>{if(y&&confirm("Remove ".concat(t," from ").concat(e,"?")))try{let s=await fetch("/api/system/groups/".concat(encodeURIComponent(e),"/members/").concat(encodeURIComponent(t)),{method:"DELETE",headers:{Authorization:"Bearer ".concat(y)}});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Failed to remove user from group")}if(await P(),(null==L?void 0:L.name)===e){let s=E.find(t=>t.name===e);s&&T({...s,members:(s.members||[]).filter(e=>e!==t)})}}catch(e){alert(e instanceof Error?e.message:"Failed to remove user from group")}},Y=C.filter(e=>e.system_gid).length,H=E.filter(e=>"wheel"===e.name||"sudo"===e.name).length;return(0,a.jsx)(o.N,{title:"GROUP MANAGER",time:w,children:(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[R&&(0,a.jsxs)("div",{className:"p-4 bg-destructive/10 border border-destructive/30 rounded-lg text-destructive text-sm flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"w-4 h-4"}),R]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Stardeck Groups"}),(0,a.jsx)(h.A,{className:"w-4 h-4 text-accent"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:C.length}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[Y," synced to system"]})]})]}),(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-muted-foreground",children:"System Groups"}),(0,a.jsx)(f.A,{className:"w-4 h-4 text-accent"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:E.length}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[H," admin group",1!==H?"s":""]})]})]}),(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsx)(d.aR,{className:"flex flex-row items-center justify-between pb-2",children:(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Actions"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(i.$,{onClick:()=>Z(!B),className:"w-full",children:B?"Cancel":"Create Group"})})]})]}),B&&(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{children:"Create New Group"}),(0,a.jsx)(d.BT,{children:"Create a new user group for permission management"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"name",children:"Group Name"}),(0,a.jsx)(c.p,{id:"name",value:I.name,onChange:e=>M({...I,name:e.target.value}),placeholder:"developers",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"display_name",children:"Display Name"}),(0,a.jsx)(c.p,{id:"display_name",value:I.display_name,onChange:e=>M({...I,display_name:e.target.value}),placeholder:"Developers",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(c.p,{id:"description",value:I.description,onChange:e=>M({...I,description:e.target.value}),placeholder:"Development team members"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m.d,{id:"sync_to_system",checked:I.sync_to_system,onCheckedChange:e=>M({...I,sync_to_system:e})}),(0,a.jsx)(u.J,{htmlFor:"sync_to_system",children:"Create as Linux system group"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),(0,a.jsx)(i.$,{type:"submit",children:"Create Group"})]})]})})]}),(0,a.jsxs)(x.tU,{value:F,onValueChange:G,children:[(0,a.jsxs)(x.j7,{children:[(0,a.jsx)(x.Xi,{value:"stardeck",children:"Stardeck Groups"}),(0,a.jsx)(x.Xi,{value:"system",children:"System Groups"})]}),(0,a.jsx)(x.av,{value:"stardeck",className:"space-y-4",children:A?(0,a.jsx)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:(0,a.jsx)(d.Wu,{className:"p-6 text-center text-muted-foreground",children:"Loading groups..."})}):0===C.length?(0,a.jsx)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:(0,a.jsx)(d.Wu,{className:"p-6 text-center text-muted-foreground",children:"No groups configured. Create your first group to get started."})}):C.map(e=>(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsx)(d.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[e.display_name,e.system_gid&&(0,a.jsxs)("span",{className:"text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded",children:["System: GID ",e.system_gid]})]}),(0,a.jsx)(d.BT,{children:e.name})]}),(0,a.jsx)(i.$,{variant:"destructive",size:"sm",onClick:()=>q(e.id),children:"Delete"})]})}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleString()]})]})]},e.id))}),(0,a.jsx)(x.av,{value:"system",className:"space-y-4",children:0===E.length?(0,a.jsx)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:(0,a.jsx)(d.Wu,{className:"p-6 text-center text-muted-foreground",children:"No system groups available."})}):E.map(e=>(0,a.jsxs)(d.Zp,{className:"border-border/60 bg-card/70 backdrop-blur-sm",children:[(0,a.jsx)(d.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[e.name,(0,a.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:["GID ",e.gid]}),("wheel"===e.name||"sudo"===e.name)&&(0,a.jsx)("span",{className:"text-xs bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 px-2 py-1 rounded",children:"Admin Group"})]}),(0,a.jsxs)(d.BT,{children:[(e.members||[]).length," member",1!==(e.members||[]).length?"s":""]})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>T(e),children:[(0,a.jsx)(b.A,{className:"w-4 h-4 mr-1"}),"Manage"]})]})}),(e.members||[]).length>0&&(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:(e.members||[]).map(t=>(0,a.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded flex items-center gap-1",children:[t,(0,a.jsx)("button",{onClick:()=>K(e.name,t),className:"ml-1 hover:text-red-500",title:"Remove ".concat(t," from ").concat(e.name),children:(0,a.jsx)(j.A,{className:"w-3 h-3"})})]},t))})})]},e.gid))})]}),(0,a.jsx)(v.lG,{open:!!L,onOpenChange:e=>!e&&T(null),children:(0,a.jsxs)(v.Cf,{children:[(0,a.jsxs)(v.c7,{children:[(0,a.jsxs)(v.L3,{children:["Manage ",null==L?void 0:L.name," Members"]}),(0,a.jsxs)(v.rr,{children:["Add or remove users from the ",null==L?void 0:L.name," group.",((null==L?void 0:L.name)==="wheel"||(null==L?void 0:L.name)==="sudo")&&(0,a.jsx)("span",{className:"block mt-1 text-amber-600 dark:text-amber-400",children:"Warning: This is an admin group. Members will have sudo privileges."})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.p,{placeholder:"Username to add...",value:W,onChange:e=>U(e.target.value),onKeyDown:e=>{"Enter"===e.key&&L&&V(L.name,W)}}),(0,a.jsx)(i.$,{onClick:()=>L&&V(L.name,W),disabled:J||!W.trim(),children:J?"Adding...":"Add"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(u.J,{className:"text-sm text-muted-foreground mb-2 block",children:"Current Members"}),0===((null==L?void 0:L.members)||[]).length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No members"}):(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:((null==L?void 0:L.members)||[]).map(e=>(0,a.jsxs)("span",{className:"text-sm bg-muted px-3 py-1 rounded-full flex items-center gap-2",children:[e,(0,a.jsx)("button",{onClick:()=>L&&K(L.name,e),className:"hover:text-red-500",children:(0,a.jsx)(j.A,{className:"w-4 h-4"})})]},e))})]})]})]})})]})})}},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>i,ZB:()=>o,Zp:()=>n,aR:()=>l});var a=s(95155);s(12115);var r=s(25016);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...s})}},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>l});var a=s(95155);s(12115);var r=s(10489),n=s(25016);function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}},90923:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>d,av:()=>i,j7:()=>o,tU:()=>l});var a=s(95155);s(12115);var r=s(65218),n=s(25016);function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"tabs",className:(0,n.cn)("flex flex-col gap-2",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)(r.B8,{"data-slot":"tabs-list",className:(0,n.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)(r.l9,{"data-slot":"tabs-trigger",className:(0,n.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)(r.UC,{"data-slot":"tabs-content",className:(0,n.cn)("flex-1 outline-none",t),...s})}}},e=>{e.O(0,[110,6263,7924,4505,9213,3652,2940,2312,8441,1255,7358],()=>e(e.s=27109)),_N_E=e.O()}]);